00100* ,
00110*   COMBAT IV BY J. LOGAJAN
00120*  MODIFIED FOR MULTI (MECC) BY BOB PETERSON.
00130 PROGRAM COM4(INPUT,OUTPUT,TAPE5=INPUT,TAPE6=OUTPUT) 
00140 COMMON/CONST/PI,RADS,PI2
00150 COMMON /SHIPS/MYPORT(15)
00160 COMMON/BLNK/ ITN(16),IDMG(15),IUN(15),NAME(2,15),KILLS(15), 
00170+ LAST(15),LACTIM(15),IPOW(15),ISHDMG(2,15),IPWRS(2,15), 
00180+ HEAD(15),ROT(15),SPDROT(15),X(15),Y(15),XV(19),YV(19),XA(15),YA(15), 
00190+ KHEAT(15),RGH(4),RGSH(4),IGW(4),LASTF(15),IDUM(4), 
00200+ INX(40,15),INXP(15),MESWPT(15),ITREP(15),REPSPD(3,15),IDDE(6), 
00210+ IGKILL(4),GDIST(4) 
00220 COMMON/BLNK/LIST(6,30),LPTR(15),IPT,IDDD(2) 
00230 COMMON/BLNK/IOMES(7,15),IXM,LMTIM(3,15) 
00240 COMMON/MULTI/K,INP(7),ISTASH(6),LREP,IT99(3)
00250 COMMON/MUSTATE/MLTH,IPORT,ITERM,IUSER,ITNCH,INLIM,INTIM 
00260 COMMON/MULTI/IBRI,IHITD,MOAN, 
00270+ LASS4,XN,XS,YS,IXXX,D,JK,IT,IOK,MYSELF,IST,RCNT,IBT, 
00280+ IBZ,IBX,MIK,JOP,KOP,IWPC,ISES,IRANG,TD,
00290+ INEG,IDEC,ISEE,IBIP,IV1,SN,CN,GSPD,GNEAR 
00300 COMMON//MTAB(4) 
00310 COMMON/MULTI/COURSE(19),RHEAD(19),AZ(19),IR(19),SPEED(19),
00320+ ISPCH(2),IFLAG(3),RCENT(15),IC,REPDIS(3),
00330+ ACEL,ITACL,IBEAM,IROTT,MOVEF,SROT,ROTAD,LASS,IRTTM,LWP,IXZX(26), 
00340+ INTERT,I,II,III,GRNG,NCOM(7),PARA(2),IPARA(2)
00350 COMMON/TIMEBLK/LUPDTTM(15),LUDT4GB(4) 
00360 LOGICAL IBRI,MYSELF,ISET,IDEC,IBX,LREP,ITYPE,IBT, 
00370+ IBZ,HALT,IROTT,MOVEF,IOK,MIK 
00380 COMMON /STUF/ XP(4),YP(4),IBUF(4,7),ITRK(15),IVLIST(7), 
00390+ MAP(15,3),LHIT(15),ITEXAS(7),MIS(15),ITHTM(4)
00400 DIMENSION NAM(40) 
00410 DATA MLTH/223/
00420 DATA MYPORT/15*1/ 
00430 DATA INWUSER/0/ 
00440 K=-1
00450 ASSIGN 5 TO IADDR $ CALL INTERPT(IADDR) 
00460 IF(ITN(16).EQ.0)GOTO 7677 
00470 WRITE(6,577) $ STOP 
00480 7677 DO 7888 I=1,15 
00490 7888 IF(ITN(I).EQ.0)GOTO 7889 
00500 GOTO 9
00510 7889 MYPORT(I)=IPORT
00520 K=I 
00530 ITN(K)=-1 
00540 LASS=0
00550 INWUSER=INWUSER+1 
00560 CALL DATETIM(IT99)
00570 CALL TIMSEC(IT) 
00580 PI=3.1415926535$ PI2=6.283185308 $ RADS=57.29577951 
00590 LREP=ISET=IBX=IDEC=IBT=IOK=IROTT=MOVEF=MYSELF=.F. 
00600 LWP=INEG=ISES=1 $ AG=10. $ IRANG=30000 $ REPDIS(1)=REPDIS(2)
00610+ =REPDIS(3)=.5
00620 IF (INWUSER.NE.1)GOTO 7676
00630 CALL PRS(IPW1,LIST(1,1),IGKILL(1),IDUM(1),GDIST(1),RGSH(1),IPT
00640+ ,INXP(1))
00650 IF(IPT.EQ.0)IPT=1 
00660 CALL RANDOM(D)
00670 DO 1112 I=1,15
00680 NAME(1,I)=NAME(2,I)=IUN(I)=10H
00690 LAST(I)=IT
00700 1112 CONTINUE 
00710 DO 1115 I=1,4 
00720 RGH(I)=I*1.570796377
00730 LUDT4GB(I)=IT 
00740 ITHTM(I)=IGW(I)=30
00750 1115 CONTINUE 
00760 7676 INP(1)=INP(2)=0
00770 ASSIGN 90 TO IADDR $ CALL HANGUP(IADDR) 
00780 WRITE(6,532) IT99 
00790 WRITE(6,521)
00800 5 IF(K.EQ.-1)GOTO 9 
00810 PRINT 2772
00820 INLIM=10000B+70 
00830 READ(END=5,5,3141) (NAM(I),I=1,40)
00840 3141 FORMAT(40A1) 
00850 II=1
00860 DO 3142 I=1,10
00870 IF(NAM(II).EQ.1H^)II=II+1 
00880 INP(1)=INP(1).OR.SHIFT((NAM(II).AND.1L;),66-6*I)
00890 II=II+1 
00900 3142 CONTINUE 
00910 DO 3143 I=1,10
00920 IF(NAM(II).EQ.1H^)II=II+1 
00930 INP(2)=INP(2).OR.SHIFT((NAM(II).AND.1L;),66-6*I)
00940 II=II+1 
00950 3143 CONTINUE 
00960 IF(INP(1).EQ.4HSTOP)THEN
00970 ITN(K)=0 $ STOP 
00980 ENDIF 
00990 IF(INP(1).EQ.1H .AND.INP(2).EQ.1H )GOTO 5 
01000 INP(3)=ITERM $ INP(4)=IUSER 
01010 CALL RANDOM(D)
01011 RCNT=D*30000.+10000.
01012 CALL RANDOM(D)
01020 HDI=D*PI2 
01030 XJ=RCNT*COS(HDI)
01040 YJ=RCNT*SIN(HDI)
01050* LOG USER INTO GAME 
01060 I=K 
01070 IUN(I)=IUSER
01080 NAME(1,I)=INP(1)
01090 NAME(2,I)=INP(2)
01100 LAST(I)=LUPDTTM(I)=INTERT=IT
01110 LACTIM(I)=KILLS(I)=IDMG(I)=ISHDMG(1,I)=ISHDMG(2,I)=ITREP(I)=
01120+ IPWRS(1,I)=IPWRS(2,I)=INXP(I)=KHEAT(I)=MESWPT(I)=
01130+ LMTIM(1,I)=LMTIM(2,I)=LMTIM(3,I)=0 
01140 IPOW(I)=35000 $ MIS(I)=25 $ IBRI=.F.
01150 XV(I)=YV(I)=XA(I)=YA(I)=ROT(I)=SPDROT(I)=SPEED(I)=0.0 
01160 REPSPD(1,I)=REPSPD(2,I)=REPSPD(3,I)=0.5 
01170 RCENT(K)=RCNT 
01180 HEAD(I)=HDI 
01190 X(I)=XJ $ ITRK(K)=LHIT(K)=0 
01200 Y(I)=YJ 
01210 ITN(K)=ITERM
01220 CALL NEWMESS(5,0,K) 
01230 IBZ=.T. 
01240 IPWRS(1,K)=IPWRS(2,K)=ISPCH(1)=ISPCH(2)=25
01250 CALL GARGOL 
01260 ASSIGN 47 TO IADDR $ CALL INTERPT(IADDR)
01270* ENTER MAIN PROGRAM 
01280 10 CALL TIMSEC(IT)
01290 IC=IT-INTERT
01300 IF(IDMG(K).GE.100)GOTO 14 
01310 INTERT=LAST(K)=IT 
01320 LASS=MAX0(IT-LASTF(K),0)
01330 CALL POT(K) 
01340 IF(IPOW(K).LE.0)GOTO 1000 
01350 CALL HITS 
01360 IF(IDMG(K).GE.100)GOTO 14 
01370 LASTF(K)=IT 
01380 IF(IOK.AND.MYSELF)GOTO 9000 
01390 IST=INXP(K) 
01400 CALL MESS 
01410 RCNT=70000.-RCENT(K)
01420 IBT=RCNT.GT.0 
01430 IBZ=RCENT(K).GT.60000 
01440 IF(IBT.AND.IBZ) WRITE(6,520) RCNT 
01450 IF(IBX.AND..NOT.IBT) WRITE(6,533) 
01460 IBX=IBT 
01470 IF(MYSELF)WRITE(6,544)
01480 MYSELF=.F.
01490 MIK=IOK=IROTT=MOVEF=.T. 
01500 IFLAG(1)=IFLAG(2)=IFLAG(3)=ITACL=LWP
01510+ =JOP=KOP=IWPC=IBEAM=0
01520 SROT=ROTAD=0.0
01530 IF(LACTIM(K).LE.0)ACEL=0
01540 I=ITRK(K) 
01550 IF(IBRI) WRITE(6,548) 
01560 IF(I.GT.20)GOTO 456 
01570 IF(ITN(I).LE.0.OR.IDMG(I).GE.100)ITRK(K)=0
01580 IF(ITRK(K).EQ.0)GOTO 79 
01590 WRITE(6,28)I,IDMG(I),IPWRS(1,I),IPWRS(2,I), 
01600+ SPEED(I),COURSE(I)*RADS,AZ(I)*RADS,IR(I),
01610+ RHEAD(I)*RADS
01620 GOTO 457
01630 456 IF(IDUM(I-20).GT.0)ITRK(K)=0
01640 IF(ITRK(K).EQ.0)GOTO 79 
01650 WRITE(6,505)I,100-IFIX(RGSH(I-20)),SPEED(I-5),COURSE(I-5)*RADS, 
01660+ AZ(I-5)*RADS,IR(I-5),RHEAD(I-5)*RADS 
01670 457 II=0
01680 DO 7776 III=1,19
01690 IF(III.GT.15)GOTO 6677
01700 J=III 
01701 IF (ITRK(K).NE.III.AND.ITN(III).GT.0.AND.IDMG(III).LE.99
01702+ .AND.III.NE.K.AND.IR(III).LT.IRANG) GOTO 6667
01703 GOTO 7776 
01704 6677 IF (ITRK(K).EQ.III+5.OR.IDUM(III-15).GT.0
01705+ .OR.IR(III).GE.IRANG) GOTO 7776
01730 J=III+5 
01740 6667 II=II+1
01750 ENCODE(10,5557,IVLIST(II))J,RHEAD(III)*RADS 
01760 INP(II)=10H S HEADNG
01770 7776 CONTINUE 
01780 5557 FORMAT(I2,1H/,F6.1,1H))
01790 IF(II.LT.7)IVLIST(II+1)=INP(II+1)=1H
01800 WRITE(6,518)K,IDMG(K),IPWRS(1,K),IPWRS(2,K),SPEED(K), 
01810+ COURSE(K)*RADS 
01820 IF(II.GE.1.AND.IBRI)PRINT 4447,(INP(III),III=1,II)
01830 IF(II.GE.1)PRINT 4447,(IVLIST(III),III=1,II)
01840 4447 FORMAT(1X,7A10)
01850 GOTO 777
01860 79 DO 25 I=1,15 
01870 IF(I.NE.K)GOTO 909
01880 WRITE(6,518) I,IDMG(I),IPWRS(1,I),IPWRS(2,I),SPEED(I),
01890+ COURSE(I)*RADS 
01900 GOTO 25 
01910 909 IF(ITN(I).LE.0)GOTO 25
01920 IF(IDMG(I).GE.100)GOTO 25 
01930 IF(IR(I).LE.IRANG)GOTO 910
01940 IF(ABS(AZ(I)).LT.0.261799388)GOTO 910 
01950 WRITE(6,28)I
01960 GOTO 25 
01970 910 WRITE(6,28) 
01980+ I,IDMG(I),IPWRS(1,I),IPWRS(2,I),SPEED(I),COURSE(I)*RADS, 
01990+ AZ(I)*RADS,IR(I),RHEAD(I)*RADS 
02000 25 CONTINUE 
02010 DO 26 I=1,4 
02020 IF(IDUM(I).GT.0)GOTO 26 
02030 IF(IR(I+15).GT.IRANG)GOTO 26
02040 WRITE(6,505)I+20,100-IFIX(RGSH(I)),SPEED(I+15),COURSE(I+15)*RADS, 
02050+ AZ(I+15)*RADS,IR(I+15),RHEAD(I+15)*RADS
02060 26 CONTINUE 
02070 777 IF(IBRI)WRITE(6,31) 
02080 WRITE(6,32) IPOW(K),ISHDMG(1,K),ISHDMG(2,K),LMTIM(1,K),MIS(K),
02090+ LMTIM(2,K),LMTIM(3,K),ACEL,LACTIM(K),IFIX(ROT(K)*RADS),
02100+ IRTTM,KHEAT(K) 
02110 47 IF(K.EQ.-1)GOTO 9
02120 PRINT 519,
02130 READ(END=47,5,4)NCOM
02140 IF(NCOM(1).EQ.1H )GOTO 10 
02150 I=L=0 
02160 IF((NCOM(1).NE.4HSTOP).AND.(NCOM(1).NE.8H^S^T^O^P))GOTO 879 
02170 WRITE(6,545)
02180 MYSELF=IOK=.T.
02190 GOTO 10 
02200 879 ISET=.F.
02210 700 IQ=I/10 
02220 N=SHIFT(NCOM(IQ+1),6*(I-10*IQ+1)).AND.1R; 
02230 IF(ISET)GOTO 180
02240 IF(N.GT.26)GOTO 70
02250 ISET=.T.
02260 ISES=1
02270 ION=N 
02280 PARA(1)=PARA(2)=0.0 
02290 878 IDEC=.F.
02300 INEG=1
02310 IEX=0 
02320 AG=10.0 
02330 GOTO 70 
02340 180 IF(ISES.EQ.3)GOTO 184 
02350 IF(N.GT.26)GOTO 181 
02360 I=I-1 
02370 GOTO 184
02380 181 IF(N.GT.36)GOTO 182 
02390 PARA(ISES)=PARA(ISES)*AG+FLOAT(INEG*(N-27))*10.**IEX
02400 IF(IDEC)IEX=IEX-1 
02410 GOTO 70 
02420 182 IF(N.NE.1R.)GOTO 183
02430 IF(IDEC)GOTO 185
02440 IDEC=.T.
02450 AG=1.0
02460 IEX=-1
02470 GOTO 70 
02480 183 IF(N.NE.1R-)GOTO 185
02490 IF(INEG.EQ.-1)GOTO 185
02500 INEG=-1 
02510 GOTO 70 
02520 185 ISES=ISES+1 
02530 GOTO 878
02540 184 ISET=.F.
02550 IPARA(1)=IFIX(PARA(1))
02560 IPARA(2)=IFIX(PARA(2))
02570 GOTO(48,49,70,70,52,53,66,9999,54,70,64,55,56,57,70,58, 
02580+ 70,59,60,61,70,82,70,70,70,62),ION 
02590 9999 IF(L.EQ.-512)GOTO 70 $ CALL HELPLI $ L=-512 $ GOTO 70
02600 61 IF(IPARA(1).NE.7898463)GOTO 70 
02610 IF(ITN(16).EQ.1)GOTO 63 
02620 ITN(16)=1 $ WRITE(6,577) $ MIK=.F. $ GOTO 70
02630 63 ITN(16)=0
02640 MIK=.F. 
02650 GOTO 70 
02660 64 IF(IPARA(1).NE.23)GOTO 70
02670 XN=-1.0 $ XN=SQRT(XN) $ GOTO 70 
02680 82 IF(IPARA(1).LT.0.OR.IPARA(1).GT.15)GOTO 458
02690 IF(IPARA(1).EQ.0)GOTO 889 
02700 IF(IPARA(1).EQ.K)GOTO 70
02710 IF(ITN(IPARA(1)).GT.0.AND.IDMG(IPARA(1)).LE.99)GOTO 889 
02720 GOTO 70 
02730 458 IF(IPARA(1).LT.21.OR.IPARA(1).GT.24)GOTO 70 
02740 IF(IDUM(IPARA(1)-20).GT.0)GOTO 70 
02750 889 ITRK(K)=IPARA(1) $ MIK=.F. $ GOTO 70
02760 48 IF(LREP.AND.ABS(PARA(1)).GT.0.0)GOTO 597 
02770 ACEL=PARA(1)
02780 ITACL=IPARA(2)
02790 ACEL=AMAX1(AMIN1(ACEL,5.),-5.)
02800 ITACL=MAX0(MIN0(ITACL,300),0) 
02810 MIK=MOVEF=.F. 
02820 GOTO 70 
02830 597 WRITE(6,534)
02840 GOTO 70 
02850 66 IRANG=IPARA(1) 
02860 GOTO 70 
02870 49 IBRI=.NOT.IBRI 
02880 GOTO 70 
02890 52 WRITE(6,535) 
02900 READ(END=70,5,4) INP
02910 IF(INP(1).EQ.1H )GOTO 70
02920 ISND=0
02930 ISEE=SHIFT(INP(1),12).AND.1R
02940 IBIP=INP(1).AND.1L
02950 IF((IBIP.EQ.1L/).AND.(ISEE.GT.27).AND.(ISEE.LE.36)) ISND=ISEE-27
02960 ISEE=SHIFT(INP(1),18).AND.1R; 
02970 IF((ISEE.GE.27).AND.(ISEE.LE.32).AND.(ISND.NE.0))ISND=(ISND*10)+
02980+ (ISEE-27)
02990 MIK=.F. 
03000 IF(ISND.GT.15)GOTO 70 
03010 IF(ISND.NE.0)GOTO 1006
03020 DO 1003 III=1,MTAB(4) 
03030 IF(III.EQ.MYPORT(K).OR.SPORT(III).LT.0)GOTO 1003
03040 PRINT 1004,K,INP
03050 1003 CONTINUE 
03060 CALL RPORT
03070 GOTO 70 
03080 1004 FORMAT("S",I2,1X,7A10) 
03090 1005 FORMAT("#",I2,1X,7A10) 
03100 1006 IF(ITN(ISND).LE.0.OR.IDMG(ISND).GT.99)GOTO 1007
03110 IF(SPORT(MYPORT(ISND)).LT.0)GOTO 1007 
03120 PRINT 1005,K,INP
03130 CALL RPORT
03140 GOTO 70 
03150 1007 CALL RPORT 
03160 PRINT 9009
03170 9009 FORMAT("NON-EXISTANT SHIP.") 
03180 GOTO 70 
03190 53 MIK=.F.
03200 ISPCH(1)=ISPCH(2)=25
03210 GOTO 70 
03220 54 JOP=IPARA(1) 
03230 KOP=IPARA(2)
03240 IF(L.EQ.-512)GOTO 70 $ L=-512 
03250 IF(JOP.NE.1)GOTO 166
03260 IF((KOP.LT.1.OR.KOP.GT.15).AND.(KOP.LT.21.OR.KOP.GT.24))GOTO 70 
03270 IF(KOP.GT.20)GOTO 661 
03280 IF(ITN(KOP).LE.0.OR.IDMG(KOP).GE.100)GOTO 70
03290 IF(KOP.NE.K)GOTO 516
03300 XN=-XV(K) 
03310 YN=-YV(K) 
03320 GOTO 356
03330 661 IF(IDUM(KOP-20).GT.0)GOTO 70
03340 KOP=KOP-5 
03350 516 XN=XV(KOP)-XV(K)
03360 YN=YV(KOP)-YV(K)
03370 356 SS=XN*XN+YN*YN
03380 SS=SQRT(SS) 
03390 IF(XN.EQ.0.0)XN=0.000001
03400 AA=ATAN2(YN,XN)-HEAD(K) 
03410 IF(IBRI)WRITE(6,587)
03420 WRITE(6,167) KOP,PICUT(AA)*RADS,SS,PICUT(AA+PI)*RADS,-SS
03430 GOTO 70 
03440 166 IF(JOP.NE.2)GOTO 168
03450 IF(X(K).EQ.0.0)X(K)=0.000001
03460 WRITE(6,567) PICUT(ATAN2(-Y(K),-X(K))-HEAD(K))*RADS,RCENT(K)
03470 GOTO 70 
03480 168 IF(JOP.NE.3)GOTO 169
03490 IF(IBRI) WRITE(6,547) 
03500 IF(KOP.EQ.0)CALL GARGOL 
03510 IV1=KOP 
03520 IF((KOP.LE.15).AND.(KOP.GE.1))CALL STAT 
03530 GOTO 70 
03540 169 IF(JOP.NE.4)GOTO 170
03550 IF(IBRI) WRITE(6,549) 
03560 L=IPT+1 
03570 DO 171 J=1,30 
03580 L=L-1 
03590 IF(L.LE.0)L=30
03600 IF(LIST(2,L).EQ.0)GOTO 70 
03610 171 WRITE(6,172) SHIFT(LIST(1,L),24).AND.1R;,LIST(1,L)
03620+ .AND.3R;;;,SHIFT(LIST(1,L),42).AND.1R;,LIST(2,L).AND.3R;;; 
03630+ ,LIST(2,L).AND.7L;;;;;;;,LIST(3,L),LIST(4,L),LIST(5,L),LIST(6,L) 
03640 L=-512
03650 GOTO 70 
03660 51 IF(IBRI) WRITE(6,279)
03670 DO 500 J=1,4
03680 IF(IDUM(J).GT.0)GOTO 500
03690 IF(GDIST(J).GT.70000)GOTO 555 
03700 WRITE(6,179) J,100-IFIX(RGSH(J)),AZ(J+15)*RADS,IR(J+15),IGKILL(J) 
03710 GOTO 500
03720 555 WRITE(6,515) J,100-IFIX(RGSH(J)),AZ(J+15)*RADS,IR(J+15),IGKILL(J) 
03730 500 CONTINUE
03740 GOTO 70 
03750 170 IF(JOP.NE.5)GOTO 51 
03760 AR=COS(HEAD(K)) 
03770 BR=SIN(HEAD(K)) 
03780 ISEG=2*IRANG/15 
03790 IF(ISEG.EQ.0)GOTO 70
03800 IF(IBRI)WRITE(6,546)ISEG
03810 DO 5547 J=1,3 
03820 DO 5547 JJ=1,15 
03830 5547 MAP(JJ,J)=10H
03840 XN=-X(K) $ YN=-Y(K) 
03850 NX=(IFIX(XN*AR+YN*BR)+IRANG)/ISEG+1 
03860 NY=(IFIX(YN*AR-XN*BR)+IRANG)/ISEG+1 
03870 IF((NX.GT.15).OR.(NX.LE.0).OR.(NY.GT.15).OR.(NY.LE.0))GOTO 5567 
03880 JT=(NY-1)/5 
03890 JT1=JT+1
03900 JU6=60-(NY-JT*5)*12 
03910 NUMAP=SHIFT(8L;;;;;;;;,JU6).AND.MAP(NX,JT1) 
03920 MAP(NX,JT1)=NUMAP.OR.SHIFT(2R+ ,JU6)
03930 5567 DO 5548 J=1,19 
03940 IF(J.GT.15)GOTO 553 
03950 XN=X(J) 
03960 YN=Y(J) 
03970 GOTO 552
03980 553 XN=XP(J-15) 
03990 YN=YP(J-15) 
04000 552 XN=XN-X(K)
04010 YN=YN-Y(K)
04020 NX=(IFIX(XN*AR+YN*BR)+IRANG)/ISEG+1 
04030 NY=(IFIX(YN*AR-XN*BR)+IRANG)/ISEG+1 
04040 IF(NX.GT.15) GOTO 5548
04050 IF(NX.LE.0)GOTO 5548
04060 IF(NY.GT.15)GOTO 5548 
04070 IF(NY.LE.0)GOTO 5548
04080 JT=(NY-1)/5 
04090 JT1=JT+1
04100 JU=(NY-JT*5)*12 
04110 JU6=60-JU 
04120 NUMAP=SHIFT(8L;;;;;;;;,JU6).AND.MAP(NX,JT1) 
04130 INMAP=SHIFT(MAP(NX,JT1),JU).AND.2R;;
04140 IF(J.GT.15)GOTO 5549
04150 IF(ITN(J).LE.0)GOTO 5548
04160 IF(IDMG(J).GE.100)GOTO 5548 
04170 IF(INMAP.NE.2R  )GOTO 550 
04180 MAP(NX,JT1)=NUMAP.OR.SHIFT(2300B.OR.J+27,JU6) 
04190 GOTO 5548 
04200 5549 IF(IDUM(J-15).GT.0)GOTO 5548 
04210 IF(INMAP.NE.2R  )GOTO 550 
04220 MAP(NX,JT1)=NUMAP.OR.SHIFT(0700B.OR.J+12,JU6) 
04230 GOTO 5548 
04240 550 MAP(NX,JT1)=NUMAP.OR.SHIFT(2R**,JU6)
04250 5548 CONTINUE 
04260 DO 551 J=1,15 
04270 551 WRITE(6,4)  (MAP(16-J,JJ),JJ=1,3) 
04280 GOTO 70 
04290 55 IF(IPARA(1).LE.0) GOTO 70
04300 IF(LWP.NE.0)GOTO 70 
04310 IBEAM=MIN0(2000,IPARA(1)) 
04320 IWPC=IWPC+1 
04330 IF(IWPC.GT.3)GOTO 70
04340 LWP=IWPC
04350 IFLAG(IWPC)=1 
04360 MIK=.F. 
04370 GOTO 70 
04380 56 IF(MIS(K).GT.0)GOTO 175
04390 WRITE(6,536)
04400 GOTO 70 
04410 175 IWPC=IWPC+1 
04420 IF(IWPC.GT.3)GOTO 70
04430 IF(IPARA(1).EQ.0)GOTO 1870
04440 MIK=.F. 
04450 IFLAG(IWPC)=IPARA(1)+1
04460 1870 IF(IPARA(2).EQ.0)GOTO 70 
04470 IWPC=IWPC+1 
04480 IF(IWPC.GT.3)GOTO 70
04490 IFLAG(IWPC)=IPARA(2)+1
04500 GOTO 70 
04510 57 MIK=.F.
04520 GOTO 70 
04530 58 IF(PARA(1).LT.0)GOTO 70
04540 IF(PARA(2).LT.0)GOTO 70 
04550 D=PARA(1)+PARA(2) 
04560 IF(D.GT.1.5)GOTO 70 
04570 MIK=.F. 
04580 REPDIS(2)=PARA(1) 
04590 REPDIS(3)=PARA(2) 
04600 REPDIS(1)=1.5-D 
04610 GOTO 70 
04620 59 MIK=IROTT=.F.
04630 IF(ABS(PARA(1)).GT.360.0)PARA(1)=SIGN(360.0,PARA(1))
04640 IF(PARA(2).LE.0.)PARA(2)=6
04650 SROT=AMIN1(PARA(2),6.)/RADS 
04660 ROTAD=PARA(1)/RADS
04670 GOTO 70 
04680 60 ISHLD=MAX0(MIN0(IPARA(1),2),1) 
04690 ISHCH=MAX0(MIN0(IPARA(2),25),0) 
04700 MIK=.F. 
04710 ISPCH(ISHLD)=ISHCH
04720 GOTO 70 
04730 62 MIK=.F.
04740 ISPCH(1)=ISPCH(2)=0 
04750 70 I=I+1
04760 IF(I.LT.70)GOTO 700 
04770 IF(MIK)GOTO 47
04780 GOTO 10 
04790 9 CALL GARGOL $ WRITE(6,537) $ STOP 
04800 1000 CALL NEWMESS(6,21,K) 
04810 14 ITN(K)=0 
04820 CALL MESS 
04830 IF(IDMG(K).NE.100)GOTO 401
04840 WRITE(6,538)
04850 STOP
04860 401 WRITE(6,539)
04870 ITN(K)=0
04880 STOP
04890 9000 ITN(K)=0 
04900 IDMG(K)=100 
04910 CALL NEWMESS(6,22,K)
04920 CALL MESS 
04930 WRITE(6,542)
04940 STOP
04950 90 IF(ITN(K).LE.0)GOTO 499
04960 IF(K.EQ.-1)GOTO 5200
04970 CALL NEWMESS(6,20,K)
04980 IF(LHIT(K).EQ.0.OR.IDMG(K).EQ.0.OR.IDMG(K).GE.100)GOTO 499
04990 IPOW(LHIT(K))=IPOW(LHIT(K))+IPOW(K) 
05000 KILLS(LHIT(K))=KILLS(LHIT(K))+1 
05010 IF(MOD(KILLS(LHIT(K)),5).EQ.0)MIS(LHIT(K))=25 
05020 499 ITN(K)=0 $ IDMG(K)=100
05030 5200 STOP 
05040 4 FORMAT(7A10)
05050 2772 FORMAT("NAME") 
05060 519 FORMAT("CMDS")
05070 518 FORMAT(I2,1X,I2,"@D",2I3,1X,F5.0,1X,F6.1) 
05080 520 FORMAT("GORN TERR.",F7.0," KM.")
05090 521 FORMAT("LIST COMBATI/UN=GMCS001 FOR INFO.", 
05100+ 1X,"STOP TO QUIT. H FOR HELP.")
05110 532 FORMAT(R9,A9,A10,"COMBAT IV+, ETC.")
05120 533 FORMAT("YOU HAVE JUST VIOLATED GORN SPACE.")
05130 534 FORMAT("IMPULSE POWER ONLY (.5 MAX)") 
05140 535 FORMAT("MESSAGE:")
05150 536 FORMAT("MISSILES EXHAUSTED")
05160 537 FORMAT("ALL SHIPS ARE IN USE - TRY AGAIN LATER")
05170 577 FORMAT("TASK LOCKED") 
05180 538 FORMAT("YOU JUST BOUGHT THE FARM.") 
05190 539 FORMAT("POWER LEVEL AT ZERO. ABANDON SHIP.")
05200 28 FORMAT(I2,1X,"@D",2I3,1X,F5.0,1X,F6.1,1X,F6.1,1X,I6,1X,F6.1) 
05210 31 FORMAT("ENERGY DMG1 DMG2 T1/M1/T2 T3 ACEL/TIM  DEG/TIM HEAT")
05220 32 FORMAT(I6,2(1X,I3,"@D"),1X,I2,"/",I2,"/",I2,1X,I2,1X,F4.1,"/", 
05230+ I3,1X,I4,"/",I3,1X,I4) 
05240 167 FORMAT(I2,2(X,F6.1,X,F5.0)) 
05250 567 FORMAT("AZ: ",F6.1," RNG: ",F8.0," TO CENTER")
05260 172 FORMAT(I2,1X,R3,1X,I2,1X,O3,1X,A7,2(1X,A10),1X,2A10)
05270 279 FORMAT("GN DMG AZMUTH  RANGE  KLS") 
05280 505 FORMAT(I2,1X,I2,"@D  -  - ",F5.0,1X,F6.1,1X,F6.1,1X,I6,1X,F6.1) 
05290 515 FORMAT(I2,1X,I2,"@D",1X,F6.1,1X,I6,I4)
05300 179 FORMAT(I2,1X,I2,"@D",1X,F6.1,1X,I6,I4," *") 
05310 542 FORMAT("-=) SELF-DESTRUCT (=-",/,"     ***BOOM***") 
05320 544 FORMAT("DESTRUCT ABORT - OBJECT WITHIN 30,000 KM.") 
05330 545 FORMAT("DESTRUCT ORDER VERIFIED.")
05340 546 FORMAT(I7," KM./SIDE",/," 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5") 
05350 547 FORMAT("SHP   COMMANDERS NAME   TER USERNUM KL")
05360 548 FORMAT("SP DMG P1 P2 SPEED COURSE AZMUTH  RANGE HEADING") 
05370 587 FORMAT("SP    ROT   SPD OR ROT   SPD")
05380 549 FORMAT( 
05390+ "SP STA KL TER USERNUM   TIME ON   TIME OFF    COMMANDERS NAME") 
05400 END 
05410 SUBROUTINE TIMSEC(I)
05420 CALL TIMEREQ(5,I) 
05430 I=SHIFT(I,24).AND.4R;;;;
05440 RETURN
05450 END 
05460 SUBROUTINE GARGOL 
05470 COMMON/MULTI/K,INP(7),ISTASH(6),LREP,IT99(3)
05480 COMMON/MULTI/IBRI,IHITD,MOAN, 
05490+ LASS4,XN,XS,YS,IXXX,D,JK,IT,IOK,MYSELF,IST,RCNT,IBT, 
05500+ IBZ,IBX,MIK,JOP,KOP,IWPC,ISES,IRANG,TD,
05510+ INEG,IDEC,ISEE,IBIP,IV1,SN,CN,GSPD,GNEAR 
05520 COMMON/MULTI/COURSE(19),RHEAD(19),AZ(19),IR(19),SPEED(19),
05530+ ISPCH(2),IFLAG(3),RCENT(15),IC,REPDIS(3),
05540+ ACEL,ITACL,IBEAM,IROTT,MOVEF,SROT,ROTAD,LASS,IRTTM,LWP,IXZX(26), 
05550+ INTERT,I,II,III,GRNG,NCOM(7),PARA(2),IPARA(2)
05560 DO 1 IV1=1,15 
05570 1 CALL STAT 
05580 RETURN
05590 END 
05600 SUBROUTINE STAT 
05610 COMMON/BLNK/ ITN(16),IDMG(15),IUN(15),NAME(2,15),KILLS(15), 
05620+ LAST(15),LACTIM(15),IPOW(15),ISHDMG(2,15),IPWRS(2,15), 
05630+ HEAD(15),ROT(15),SPDROT(15),X(15),Y(15),XV(19),YV(19),XA(15),YA(15), 
05640+ KHEAT(15),RGH(4),RGSH(4),IGW(4),LASTF(15),IDUM(4), 
05650+ INX(40,15),INXP(15),MESWPT(15),ITREP(15),REPSPD(3,15),IDDE(6), 
05660+ IGKILL(4),GDIST(4) 
05670 COMMON/BLNK/LIST(6,30),LPTR(15),IPT,IDDD(2) 
05680 COMMON/BLNK/IOMES(7,15),IXM,LMTIM(3,15) 
05690 COMMON/MULTI/K,INP(7),ISTASH(6),LREP,IT99(3)
05700 COMMON/MULTI/IBRI,IHITD,MOAN, 
05710+ LASS4,XN,XS,YS,IXXX,D,JK,IT,IOK,MYSELF,IST,RCNT,IBT, 
05720+ IBZ,IBX,MIK,JOP,KOP,IWPC,ISES,IRANG,TD,
05730+ INEG,IDEC,ISEE,IBIP,IV1,SN,CN,GSPD,GNEAR 
05740 COMMON/MULTI/COURSE(19),RHEAD(19),AZ(19),IR(19),SPEED(19),
05750+ ISPCH(2),IFLAG(3),RCENT(15),IC,REPDIS(3),
05760+ ACEL,ITACL,IBEAM,IROTT,MOVEF,SROT,ROTAD,LASS,IRTTM,LWP,IXZX(26), 
05770+ INTERT,I,II,III,GRNG,NCOM(7),PARA(2),IPARA(2)
05780 IF((ITN(IV1).GT.0).AND.(IDMG(IV1).LT.100)) WRITE(6,1) 
05790+ IV1,NAME(1,IV1),NAME(2,IV1),ITN(IV1),IUN(IV1),KILLS(IV1) 
05800 RETURN
05810 1 FORMAT(I2,1X,2A10,1X,O3,1X,A7,1X,I2)
05820 END 
05830 FUNCTION PICUT(ANGLE) 
05840 COMMON/CONST/PI,RADS,PI2
05850 COMMON/MULTI/K,INP(7),ISTASH(6),LREP,IT99(3)
05860 COMMON/MULTI/IBRI,IHITD,MOAN, 
05870+ LASS4,XN,XS,YS,IXXX,D,JK,IT,IOK,MYSELF,IST,RCNT,IBT, 
05880+ IBZ,IBX,MIK,JOP,KOP,IWPC,ISES,IRANG,TD,
05890+ INEG,IDEC,ISEE,IBIP,IV1,SN,CN,GSPD,GNEAR 
05900 COMMON/MULTI/COURSE(19),RHEAD(19),AZ(19),IR(19),SPEED(19),
05910+ ISPCH(2),IFLAG(3),RCENT(15),IC,REPDIS(3),
05920+ ACEL,ITACL,IBEAM,IROTT,MOVEF,SROT,ROTAD,LASS,IRTTM,LWP,IXZX(26), 
05930+ INTERT,I,II,III,GRNG,NCOM(7),PARA(2),IPARA(2)
05940 PICUT=SIGN(1.,ANGLE)*(ABS(ANGLE)-PI2*(AINT((PI+ABS(ANGLE))/PI2))) 
05950 RETURN
05960 END 
05970 SUBROUTINE NEWMESS(I,J,L) 
05980 COMMON/CONST/PI,RADS,PI2
05990 COMMON/BLNK/ ITN(16),IDMG(15),IUN(15),NAME(2,15),KILLS(15), 
06000+ LAST(15),LACTIM(15),IPOW(15),ISHDMG(2,15),IPWRS(2,15), 
06010+ HEAD(15),ROT(15),SPDROT(15),X(15),Y(15),XV(19),YV(19),XA(15),YA(15), 
06020+ KHEAT(15),RGH(4),RGSH(4),IGW(4),LASTF(15),IDUM(4), 
06030+ INX(40,15),INXP(15),MESWPT(15),ITREP(15),REPSPD(3,15),IDDE(6), 
06040+ IGKILL(4),GDIST(4) 
06050 COMMON/BLNK/LIST(6,30),LPTR(15),IPT,IDDD(2) 
06060 COMMON/BLNK/IOMES(7,15),IXM,LMTIM(3,15) 
06070 COMMON/MULTI/K,INP(7),ISTASH(6),LREP,IT99(3)
06080 COMMON/MULTI/IBRI,IHITD,MOAN, 
06090+ LASS4,XN,XS,YS,IXXX,D,JK,IT,IOK,MYSELF,IST,RCNT,IBT, 
06100+ IBZ,IBX,MIK,JOP,KOP,IWPC,ISES,IRANG,TD,
06110+ INEG,IDEC,ISEE,IBIP,IV1,SN,CN,GSPD,GNEAR 
06120 COMMON/MULTI/COURSE(19),RHEAD(19),AZ(19),IR(19),SPEED(19),
06130+ ISPCH(2),IFLAG(3),RCENT(15),IC,REPDIS(3),
06140+ ACEL,ITACL,IBEAM,IROTT,MOVEF,SROT,ROTAD,LASS,IRTTM,LWP,IXZX(26), 
06150+ INTERT,IQ,II,III,GRNG,NCOM(7),PARA(2),IPARA(2) 
06160 COMMON/X/IO,IP
06170 LOGICAL IO
06180 DIMENSION MX(23)
06190 DATA MX/3RDD1,3RDD2,3RDD3,3RDD4,3RDD5,3RDD6,3RDD7,3RDD8,3RDD9,
06200+ 3RD10,3RD11,3RD12,3RD13,3RD14,3RD15, 
06210+ 3RDG1,3RDG2,3RDG3,3RDG4,3RHNG,3RLPR,3RDDS,3RPUR/ 
06220 CALL DATETIM(IT99)
06230 MT=IT99(3)
06240 IZT=MOD(IPT,30)+1 
06250 IP=SHIFT(LIST(1,IZT),24).AND.4R;;;; 
06260 IO=(LIST(I,IZT).AND.3R;;;).EQ.3R
06270 M=SHIFT(I,36).OR.SHIFT(J,24).OR.SHIFT(L,48) 
06280 IF(I.EQ.5)GOTO 1
06290 IF(L.GE.16)GOTO 9 
06300 NS=LPTR(L)
06310 IF(NS.EQ.0)GOTO 5 
06320 LIST(1,NS)=(LIST(1,NS).AND.7L;;;;;;;).OR.MX(J)
06330 LIST(4,NS)=MT 
06340 LIST(1,NS)=LIST(1,NS).OR.SHIFT(KILLS(L),18) 
06350 5 N=3 
06360 IF(J.LE.15) N=5 
06370 7 LL1=L 
06380 IF(L.GT.15) LL1=J 
06390 IF(J.EQ.23)RETURN 
06400 DO 6 NS=1,15
06410 IF(ITN(NS).LE.0)GOTO 6
06420 IF(IDMG(NS).GE.100)GOTO 6 
06430 IF((I.EQ.5).AND.(NS.EQ.K))GOTO 6
06440 IG=INXP(NS) 
06450 IF(IG+N.GT.40) IG=0 
06460 INX(IG+1,NS)=M
06470 INX(IG+2,NS)=NAME(1,LL1)
06480 INX(IG+3,NS)=NAME(2,LL1)
06490 INXP(NS)=IG+3 
06500 IF(N.NE.5) GOTO 6 
06510 INX(IG+4,NS)=NAME(1,J)
06520 INX(IG+5,NS)=NAME(2,J)
06530 INXP(NS)=INXP(NS)+2 
06540 6 CONTINUE
06550 RETURN
06560 1 CALL SUBR 
06570 IPT=IZT 
06580 LIST(1,IPT)=SHIFT(L,36).OR.3R 
06590 LIST(2,IPT)=ITN(L).OR.IUN(L)
06600 LIST(3,IPT)=MT
06610 LIST(4,IPT)=1H
06620 LIST(5,IPT)=NAME(1,L) 
06630 LIST(6,IPT)=NAME(2,L) 
06640 LPTR(L)=IPT 
06650 N=3 
06660 GOTO 7
06670 9 CALL SUBR 
06680 IPT=IZT 
06690 LIST(1,IPT)=SHIFT(L+5,36).OR.SHIFT(IGKILL(L-15),18).OR.MX(J)
06700 LIST(2,IPT)=7LDMS****.OR.777B 
06710 LIST(3,IPT)=10H UNKNOWN 
06720 LIST(4,IPT)=MT
06730 LIST(5,IPT)=LIST(6,IPT)=1H
06740 N=3 
06750 END 
06760 SUBROUTINE SUBR 
06770 COMMON/BLNK/ ITN(16),IDMG(15),IUN(15),NAME(2,15),KILLS(15), 
06780+ LAST(15),LACTIM(15),IPOW(15),ISHDMG(2,15),IPWRS(2,15), 
06790+ HEAD(15),ROT(15),SPDROT(15),X(15),Y(15),XV(19),YV(19),XA(15),YA(15), 
06800+ KHEAT(15),RGH(4),RGSH(4),IGW(4),LASTF(15),IDUM(4), 
06810+ INX(40,15),INXP(15),MESWPT(15),ITREP(15),REPSPD(3,15),IDDE(6), 
06820+ IGKILL(4),GDIST(4) 
06830 COMMON/BLNK/LIST(6,30),LPTR(15),IPT,IDDD(2) 
06840 COMMON/BLNK/IOMES(7,15),IXM,LMTIM(3,15) 
06850 COMMON/X/IO,IP
06860 LOGICAL IO
06870 IF(IPT.EQ.0)RETURN
06880 IF(IO) LPTR(IP)=0 
06890 RETURN
06900 END 
06910 SUBROUTINE MESS 
06920 COMMON/CONST/PI,RADS,PI2
06930 COMMON/BLNK/ ITN(16),IDMG(15),IUN(15),NAME(2,15),KILLS(15), 
06940+ LAST(15),LACTIM(15),IPOW(15),ISHDMG(2,15),IPWRS(2,15), 
06950+ HEAD(15),ROT(15),SPDROT(15),X(15),Y(15),XV(19),YV(19),XA(15),YA(15), 
06960+ KHEAT(15),RGH(4),RGSH(4),IGW(4),LASTF(15),IDUM(4), 
06970+ INX(40,15),INXP(15),MESWPT(15),ITREP(15),REPSPD(3,15),IDDE(6), 
06980+ IGKILL(4),GDIST(4) 
06990 COMMON/BLNK/LIST(6,30),LPTR(15),IPT,IDDD(2) 
07000 COMMON/BLNK/IOMES(7,15),IXM,LMTIM(3,15) 
07010 COMMON/MULTI/K,INP(7),ISTASH(6),LREP,IT99(3)
07020 COMMON/MULTI/IBRI,IHITD,MOAN, 
07030+ LASS4,XN,XS,YS,IXXX,D,JK,IT,IOK,MYSELF,IST,RCNT,IBT, 
07040+ IBZ,IBX,MIK,JOP,KOP,IWPC,ISES,IRANG,TD,
07050+ INEG,IDEC,ISEE,IBIP,IV1,SN,CN,GSPD,GNEAR 
07060 COMMON/MULTI/COURSE(19),RHEAD(19),AZ(19),IR(19),SPEED(19),
07070+ ISPCH(2),IFLAG(3),RCENT(15),IC,REPDIS(3),
07080+ ACEL,ITACL,IBEAM,IROTT,MOVEF,SROT,ROTAD,LASS,IRTTM,LWP,IXZX(26), 
07090+ INTERT,I,II,III,GRNG,NCOM(7),PARA(2),IPARA(2)
07100 LOGICAL LREP
07110 COMMON /STUF/ XP(4),YP(4),IBUF(4,7),ITRK(15),IVLIST(7), 
07120+ MAP(15,3),LHIT(15),ITEXAS(7),MIS(15),ITHTM(4)
07130 DIMENSION I1(5),I2(5) 
07140 DATA I1,I2/10HWAS DESTRO,10HHUNGUP.   ,10HLOST ALL P, 
07150+ 10HSELF-DESTR,10HAPPEARED  ,10HYED       ,10H          , 
07160+ 10HOWER      ,10HUCTED     ,10H          / 
07170 IF(INXP(K).EQ.0) RETURN 
07180 I=0 
07190 20 I=I+1
07200 IAM=INX(I,K)
07210 IVIC=SHIFT(IAM,12).AND.2R;; 
07220 IMES=SHIFT(IAM,24).AND.2R;; 
07230 IATK=SHIFT(IAM,36).AND.2R;; 
07240 ISDM=IAM.AND.2R;; 
07250 IF(IMES.EQ.5)GOTO 1 
07260 IBLAST=8L>>PWNG<< 
07270 IF(IMES.EQ.6)GOTO 14
07280 IF(IMES.EQ.7)GOTO 44
07290 IF(K.EQ.IATK)GOTO 33
07300 IF(ISDM.GE.20) IBLAST=8L**BLAM**
07310 IF(IATK.GT.15)GOTO 7
07320 IF(IMES.GT.2) WRITE(6,2)IBLAST,IATK,IMES-2,ISDM 
07330 IF(IMES.LT.3)WRITE(6,3)IBLAST,IATK,IMES,ISDM
07340 GOTO 4
07350 44 WRITE(6,35)
07360 LREP=.T.
07370 GOTO 4
07380 33 IF(IVIC.GT.15)GOTO 8 
07390 IF(IMES.GT.2)WRITE(6,5)IMES-2,IVIC,ISDM 
07400 IF(IMES.LT.3)WRITE(6,6)IMES,IVIC,ISDM 
07410 GOTO 4
07420 7 WRITE(6,10)IBLAST,IATK-15,IMES,ISDM 
07421 GOTO 4
07422 8 IF (IMES.EQ.1) WRITE(6,12) IVIC-15,ISDM 
07423 IF (IMES.EQ.3) WRITE(6,13) IVIC-15,ISDM 
07430 GOTO 4
07440 1 WRITE(6,15)IVIC,INX(I+1,K),INX(I+2,K),I1(5),I2(5) 
07450 I=I+1 
07460 ITN(16)=0 
07470 GOTO 4
07480 14 II=1 
07490 IF(IVIC.GE.16)GOTO 21 
07500 IF(IATK.GE.20) II=IATK-18 
07510 WRITE(6,15)IVIC,INX(I+1,K),INX(I+2,K),I1(II),I2(II) 
07520 I=I+2 
07530 ITN(16)=0 
07540 GOTO 24 
07550 21 WRITE(6,22)IVIC-15 
07560 24 IF(IATK.LE.15)GOTO 16
07570 IF(IATK.GE.20)GOTO 4
07580 WRITE(6,17)IATK-15
07590 GOTO 4
07600 16 WRITE(6,18)IATK,INX(I+1,K),INX(I+2,K)
07610 I=I+2 
07620 4 IF(I.LT.INXP(K))GOTO 20 
07630 INXP(K)=0 
07640 RETURN
07650 2 FORMAT(A8," S",I2," LSR HIT SHLD",I2," FOR ",I3,
07660+ "@D")
07670 3 FORMAT(A9," S",I2," MSL HIT SHLD",I2," FOR ",I3,
07680+ "@D")
07690 5 FORMAT("LSR HIT SHLD",I2," OF S",I2," FOR ",
07700+ I3,"@D") 
07710 6 FORMAT("MSL HIT SHLD",I2," OF S",I2," FOR ",
07720+ I3,"@D") 
07730 10 FORMAT(A9," GORN",I2," PHASER HIT SHLD",I2," FOR ",
07740+ I3,"@D") 
07750 12 FORMAT("MSL HIT GORN BASE",I2," FOR ",I3,"@D") 
07760 13 FORMAT("LSR HIT GORN BASE",I2," FOR ",I3,"@D") 
07770 15 FORMAT("S",I2," - ",2A10,1X,A10,A5)
07780 17 FORMAT("BY GORN BASE",I2)
07790 18 FORMAT("BY S",I2, " - ",2A10)
07800 22 FORMAT("** GORN BASE",I2," WAS DESTROYED **")
07810 35 FORMAT("*BANG* SHIPS ENGINE JUST BLEW UP - IMPULSE POWER ONLY.") 
07820 END 
07830 SUBROUTINE POT(N) 
07840 COMMON/CONST/PI,RADS,PI2
07850 COMMON /SHIPS/MYPORT(15)
07860 COMMON/BLNK/ ITN(16),IDMG(15),IUN(15),NAME(2,15),KILLS(15), 
07870+ LAST(15),LACTIM(15),IPOW(15),ISHDMG(2,15),IPWRS(2,15), 
07880+ HEAD(15),ROT(15),SPDROT(15),X(15),Y(15),XV(19),YV(19),XA(15),YA(15), 
07890+ KHEAT(15),RGH(4),RGSH(4),IGW(4),LASTF(15),IDUM(4), 
07900+ INX(40,15),INXP(15),MESWPT(15),ITREP(15),REPSPD(3,15),IDDE(6), 
07910+ IGKILL(4),GDIST(4) 
07920 COMMON/BLNK/LIST(6,30),LPTR(15),IPT,IDDD(2) 
07930 COMMON/BLNK/IOMES(7,15),IXM,LMTIM(3,15) 
07940 COMMON/MULTI/K,INP(7),ISTASH(6),LREP,IT99(3)
07950 COMMON/MUSTATE/MLTH,IPORT,ITERM,IUSER,ITNCH,INLIM,INTIM 
07960 COMMON/MULTI/IBRI,IHITD,MOAN, 
07970+ LASS4,XN,XS,YS,IXXX,D,JK,IT,IOK,MYSELF,IST,RCNT,IBT, 
07980+ IBZ,IBX,MIK,JOP,KOP,IWPC,ISES,IRANG,TD,
07990+ INEG,IDEC,ISEE,IBIP,IV1,SN,CN,GSPD,GNEAR 
08000 COMMON//MTAB(4) 
08010 COMMON/MULTI/COURSE(19),RHEAD(19),AZ(19),IR(19),SPEED(19),
08020+ ISPCH(2),IFLAG(3),RCENT(15),IC,REPDIS(3),
08030+ ACEL,ITACL,IBEAM,IROTT,MOVEF,SROT,ROTAD,LASS,IRTTM,LWP,IXZX(26), 
08040+ INTERT,I,II,III,GRNG,NCOM(7),PARA(2),IPARA(2)
08050 COMMON/TIMEBLK/LUPDTTM(15),LUDT4GB(4) 
08060 COMMON /STUF/ XP(4),YP(4),IBUF(4,7),ITRK(15),IVLIST(7), 
08070+ MAP(15,3),LHIT(15),ITEXAS(7),MIS(15),ITHTM(4)
08080 LOGICAL MOVEF,IROTT 
08090 IVUICDS=IT-LUPDTTM(N) 
08100* INTEGER VARIABLE USED IN CALCULATING DATA OF A SHIP= 
08110* PRESENT TIME - LAST UPDATE TIME ON THAT SHIP.
08120 LUPDTTM(N)=IT 
08130 F=FLOAT(IVUICDS)
08140 ITI=MIN0(IVUICDS,LACTIM(N)) 
08150 A=FLOAT(ITI)
08160 LACTIM(N)=LACTIM(N)-ITI 
08170 ACCEL=SQRT(XA(N)*XA(N)+YA(N)*YA(N)) 
08180 IF(ROT(N)*SPDROT(N)*F.EQ.0.0)GOTO 2 
08190 RT=AMIN1(F,ABS(ROT(N)/SPDROT(N))) 
08200 BD=SIGN(RT*SPDROT(N),ROT(N))
08210 ROT(N)=ROT(N)-BD
08220 HEAD(N)=HEAD(N)+BD
08230 IF(A*ACCEL.EQ.0)GOTO 2
08240 TT=A
08250 TZ=0.0
08260 IF(A.LE.RT)GOTO 53
08270 TT=RT 
08280 TZ=A-RT 
08290 53 BD=TT*SPDROT(N)
08300 H=ACCEL/SPDROT(N) 
08310 HH=H/SPDROT(N)
08320 XX=SIN(HEAD(N)) 
08330 YY=COS(HEAD(N)) 
08340 DD1=SIN(BD) 
08350 DD2=1.-COS(BD)
08360 XN=HH*DD2 
08370 YN=HH*(BD-DD1)
08380 P=SQRT(XN*XN+YN*YN) 
08390 XN=P*XX 
08400 YN=P*YY 
08410 X(N)=X(N)+XV(N)*F+XN
08420 Y(N)=Y(N)+YV(N)*F+YN
08430 XN=H*DD1
08440 YN=H*DD2
08450 P=SQRT(XN*XN+YN*YN) 
08460 XV(N)=XV(N)+P*XX
08470 YV(N)=YV(N)+P*YY
08480 IF(TZ.GT.0.)GOTO 54 
08490 GOTO 5
08500 2 TZ=A
08510 54 X(N)=X(N)+XV(N)*F+XA(N)*TZ*TZ/2.0
08520 Y(N)=Y(N)+YV(N)*F+YA(N)*TZ*TZ/2.0 
08530 XV(N)=XV(N)+XA(N)*TZ
08540 YV(N)=YV(N)+YA(N)*TZ
08550 5 KI=KHEAT(N) 
08560 I9=IFIX(35.*ACCEL)
08570 I7=I9-20
08580 IT7=ITI*I7
08590 KPEAK=MAX0(IT7,0)+KI
08600 KHEAT(N)=MAX0(KI-IVUICDS*20+ITI*I9,0) 
08610 I9=0
08620 IF(KPEAK.LE.5000)GOTO 88
08630 IF(I7.LE.0) GOTO 99 
08640 IF(KI.LT.5000) I9=ITI+(KI-5000)/I7
08650 I9=I9+MIN0(IVUICDS,(KPEAK-5000)/20) 
08660 GOTO 88 
08670 99 IHAB=KI+IT7-5000 
08680 IF(IHAB.GT.0) GOTO 89 
08690 I9=(KI-5000)/I7 
08700 GOTO 88 
08710 89 I9=MIN0(IHAB/20,IVUICDS-ITI)+ITI 
08720 88 IPOW(N)=IPOW(N)-IVUICDS*(IPWRS(1,N)+IPWRS(2,N))/2-25*
08730+ (I9+IFIX(ACCEL*A)) 
08740 RPS=AMAX1(FLOAT(IVUICDS-ITREP(N)),0.) 
08741 IDMG(N)=MAX0(IDMG(N)-IFIX(RPS*REPSPD(1,N)),0) 
08750 ISHDMG(1,N)=MAX0(ISHDMG(1,N)-IFIX(RPS*REPSPD(2,N)),0) 
08760 ISHDMG(2,N)=MAX0(ISHDMG(2,N)-IFIX(RPS*REPSPD(3,N)),0) 
08770 ITREP(N)=MAX0(ITREP(N)-IVUICDS,0) 
08780 IF(K.NE.N)GOTO 6
08790 IF(MOVEF)GOTO 7 
08800 LACTIM(N)=ITACL 
08810 XA(N)=ACEL*COS(HEAD(N)) 
08820 YA(N)=ACEL*SIN(HEAD(N)) 
08830 7 IF(IROTT) GOTO 8
08840 SPDROT(N)=SROT
08850 ROT(N)=ROTAD
08860 8 IRTTM=IABS(IFIX(ROT(N)/SPDROT(N)))
08870 IPWRS(1,N)=MIN0(ISPCH(1),(100-ISHDMG(1,N))/4) 
08880 IPWRS(2,N)=MIN0(ISPCH(2),(100-ISHDMG(2,N))/4) 
08890 DO 77 MM=1,3
08900 REPSPD(MM,N)=REPDIS(MM) 
08910 LMTIM(MM,N)=MAX0(LMTIM(MM,N)-IC,0)
08920 77 CONTINUE 
08930 IF(IBEAM.EQ.0)GOTO 6
08940 IF(LMTIM(3,K).GT.0)GOTO 66
08950 IF(IFLAG(LWP).NE.1)GOTO 66
08960 IBEAM=MIN0(IPOW(N)-1,IBEAM) 
08970 IF(N.EQ.K)IPOW(N)=IPOW(N)-IBEAM 
08980 LMTIM(3,K)=IBEAM/40+10
08990 GOTO 6
09000 66 IFLAG(LWP)=0 
09010 6 IF(IPOW(N).GT.0.OR.N.NE.K)GOTO 10 
09020 IPOW(N)=0 
09030 IDMG(N)=300 
09040 RETURN
09050 10 IF(KPEAK.LT.8000)GOTO 11 
09060 IDMG(N)=MIN0(IDMG(N)+10,99) 
09070 ITREP(N)=40 
09080 INXP(N)=MOD(INXP(N),40)+1 
09090 INX(INXP(N),N)=7000000000000B 
09100 KHEAT(N)=7999 
09110 XA(N)=YA(N)=0 
09120 LACTIM(N)=0 
09130 11 SPEED(N)=SQRT(XV(N)*XV(N)+YV(N)*YV(N)) 
09140 XN=X(N)-X(K)
09150 YN=Y(N)-Y(K)
09160 IR(N)=IFIX(SQRT(XN*XN+YN*YN)) 
09170 RCENT(N)=SQRT(X(N)*X(N)+Y(N)*Y(N))
09180 IF(XN.EQ.0.) XN=0.000001
09190 TD=ATAN2(YN,XN) 
09200 IF(K.EQ.N) TD=HEAD(N) 
09210 AZ(N)=PICUT(TD-HEAD(K)) 
09220 IF(K.NE.N) TD=TD-PI 
09230 IF(XV(N).EQ.0.) XV(N)=0.000001
09240 COURSE(N)=PICUT(TD-ATAN2(YV(N),XV(N)))
09250 RHEAD(N)=PICUT(TD-HEAD(N))
09260 RETURN
09270 END 
09280 SUBROUTINE  HELPLI
09290 PRINT,"      SHORT COMBAT HELP" 
09300 PRINT,"      ===== ====== ====" 
09310 PRINT,"FOR MORE HELP, LIST OLD,COMINFO/UN=GAP****." 
09320 PRINT,"AX,Y -ACCELERATE AT X(KM/SEC@D2) FOR Y SECONDS"
09330 PRINT,"B    -TOGGLES BRIEF MODE (HEADERS ELIMINATED)" 
09340 PRINT,"E    -SEND A MESSAGE TO ALL USERS OF COMBAT" 
09350 PRINT,"     /N AT BEGINNING OF LINE SENDS ONLY TO SHIP N" 
09360 PRINT,"F    -GIVES FULL POWER TO BOTH SHIELDS"
09370 PRINT,"GX   -CHANGE SENSOR RANGE TO X KM."
09380 PRINT,"IX   -INTELLIGENCE REPORT (MANY PARAMETERS)" 
09390 PRINT,"     I1,N - GIVE PARALLELING DATA FOR SHIP N"
09400 PRINT,"     I2 - GIVE RANGE AND AZIMUTH TO CENTER OF COMBAT ZONE."
09410 PRINT,"     I3,N - GIVE NAMES AND RELATED DATA ON SHIP N" 
09420 PRINT,"     I4 - PRINT DAYFILE" 
09430 PRINT,"     I5 - PRINT MAP ACCORDING TO SENSOR RANGE" 
09440 PRINT,"     I6 - GIVE DATA ON GORNS"
09450 PRINT,"LX   -FIRE LASERS WITH X UNITS OF ENERGY"
09460 PRINT,"MX,Y -FIRE MISSLES AT SHIP(S) X AND Y" 
09470 PRINT,"N    -DO NOTHING (GIVE LATEST STATUS INFO)"
09480 PRINT,"P    -DISTRIBUTE REPAIR RATE AMONG SHIELDS"
09490 PRINT,"RX,Y -ROTATE X DEGREES IN Y DEG/SEC (Y MUST BE <7)"
09500 PRINT,"SX,Y -SET SHIELD X TO POWER OF Y (0<=Y<=25)" 
09510 PRINT,"STOP -SELF DESTRUCT (YOU CHICKEN, YOU)"
09520 PRINT,"VX   -TRACK SHIP X. (ALL OTHER SHIPS HEADING ARE GIVEN)" 
09530 PRINT,"Z    -ZERO POWER ON BOTH SHIELDS"
09540 PRINT,"-CR- SAME AS N COMMAND"
09550 RETURN
09560 END 
09570 SUBROUTINE HITS 
09580 COMMON/CONST/PI,RADS,PI2
09590 COMMON /SHIPS/MYPORT(15)
09600 COMMON/BLNK/ ITN(16),IDMG(15),IUN(15),NAME(2,15),KILLS(15), 
09610+ LAST(15),LACTIM(15),IPOW(15),ISHDMG(2,15),IPWRS(2,15), 
09620+ HEAD(15),ROT(15),SPDROT(15),X(15),Y(15),XV(19),YV(19),XA(15),YA(15), 
09630+ KHEAT(15),RGH(4),RGSH(4),IGW(4),LASTF(15),IDUM(4), 
09640+ INX(40,15),INXP(15),MESWPT(15),ITREP(15),REPSPD(3,15),IDDE(6), 
09650+ IGKILL(4),GDIST(4) 
09660 COMMON/BLNK/LIST(6,30),LPTR(15),IPT,IDDD(2) 
09670 COMMON/BLNK/IOMES(7,15),IXM,LMTIM(3,15) 
09680 COMMON/MULTI/K,INP(7),ISTASH(6),LREP,IT99(3)
09690 COMMON/MUSTATE/MLTH,IPORT,ITERM,IUSER,ITNCH,INLIM,INTIM 
09700 COMMON/MULTI/IBRI,IHITD,MOAN, 
09710+ LASS4,XN,XS,YS,IXXX,D,JK,IT,IOK,MYSELF,IST,RCNT,IBT, 
09720+ IBZ,IBX,MIK,JOP,KOP,IWPC,ISES,IRANG,TD,
09730+ INEG,IDEC,ISEE,IBIP,IV1,SN,CN,GSPD,GNEAR 
09740 COMMON//MTAB(4) 
09750 COMMON/MULTI/COURSE(19),RHEAD(19),AZ(19),IR(19),SPEED(19),
09760+ ISPCH(2),IFLAG(3),RCENT(15),IC,REPDIS(3),
09770+ ACEL,ITACL,IBEAM,IROTT,MOVEF,SROT,ROTAD,LASS,IRTTM,LWP,IXZX(26), 
09780+ INTERT,I,II,III,GRNG,NCOM(7),PARA(2),IPARA(2)
09790 COMMON/TIMEBLK/LUPDTTM(15),LUDT4GB(4) 
09800 COMMON /STUF/ XP(4),YP(4),IBUF(4,7),ITRK(15),IVLIST(7), 
09810+ MAP(15,3),LHIT(15),ITEXAS(7),MIS(15),ITHTM(4)
09820 LOGICAL LREP,IOK
09830 CALL RANDOM(D)
09840 IF (IDMG(K).EQ.0.AND.KHEAT(K).LT.1000.AND.D.GT.0.9.AND.LREP)THEN
09850 PRINT 1633
09860 1633 FORMAT("ENGINE IS REPAIRED") 
09870 LREP=.F.
09880 ENDIF 
09890 DO 15 I=1,15
09900 IC=INTERT-LAST(I) 
09910 IF(I.EQ.K)GOTO 15 
09920 IF(ITN(I).EQ.0)GOTO 15
09930 IF(IDMG(I).GE.100)GOTO 15 
09940 CALL POT(I) 
09950 IF(IDMG(I).GE.100)GOTO 15 
09960* DETERMINE HITS MADE
09970 JK=1
09980 IF(IR(I).LT.30000)IOK=.F. 
09990 IF(ABS(RHEAD(I)).GT.0.523598776) JK=2 
10000 DO 18 J=1,3 
10010 IF(IFLAG(J).EQ.0)GOTO 18
10020 IF(IFLAG(J).EQ.1)GOTO 19
10030 IF (MIS(K).EQ.0)GOTO 18 
10040 IF(IFLAG(J)-1.NE.I)GOTO 18
10050 IF(LMTIM(1,K).GT.0)GOTO 650 
10060 LMTIM(1,K)=60 
10070 GOTO 651
10080 650 IF(LMTIM(2,K).GT.0)GOTO 18
10090 LMTIM(2,K)=60 
10100 651 MIS(K)=MIS(K)-1 
10110 IF(IR(I).GE.20000)GOTO 18 
10120 IF(ABS(AZ(I)).GT.0.087266463)GOTO 18
10130 IHITD=102-IPWRS(JK,I)*4 
10140 GOTO 933
10150 19 IF(ABS(AZ(I)).GT.0.018325783)GOTO 18 
10160 IHITD=IBEAM*12*(33-IPWRS(JK,I))/(IR(I)+1) 
10170 IF(IHITD.EQ.0)GOTO 18 
10180 933 IHIT=IHITD/2
10190 IF(JK.EQ.1)IHITD=IHIT 
10200 ITREP(I)=MAX0(ITREP(I),40)
10210 IHITD=MIN0(IHITD,100-ISHDMG(JK,I))
10220 ISHDMG(JK,I)=ISHDMG(JK,I)+IHITD 
10230 IPWRS(JK,I)=MIN0(IPWRS(JK,I),(100-ISHDMG(JK,I))/4)
10240 IHIT=MIN0(IHIT,100-IDMG(I)) 
10250 IDMG(I)=IDMG(I)+IHIT
10260 LHIT(I)=K 
10270 INXP(I)=MOD(INXP(I),40)+1 
10280 MOAN=JK 
10290 IF(IFLAG(J).EQ.1)MOAN=MOAN+2
10300 MOAN=IHIT.OR.SHIFT(IHITD,12).OR.SHIFT(K,24).OR. 
10310+ SHIFT(MOAN,36).OR.SHIFT(I,48)
10320 INX(INXP(I),I)=MOAN 
10330 INXP(K)=MOD(INXP(K),40)+1 
10340 INX(INXP(K),K)=MOAN 
10350 IF(IDMG(I).LT.100)GOTO 18 
10360 CALL NEWMESS(6,K,I) 
10370 KILLS(K)=KILLS(K)+1 
10380 IF(MOD(KILLS(K),5).EQ.0)MIS(K)=25 
10390 IPOW(K)=IPOW(K)+IPOW(I)+5000
10400 ITRK(K)=0 
10410 GOTO 15 
10420 18 CONTINUE 
10430 15 CONTINUE 
10440* DETERMINE HITS MADE BY GORNS 
10450 DO 890 J=1,4
10460 LASS4=MAX0(IT-LUDT4GB(J),0) 
10470 LUDT4GB(J)=IT 
10480 RGH(J)=RGH(J)+LASS4*0.0009
10490 SN=SIN(RGH(J)) $ CN=COS(RGH(J)) 
10500 GSPD=(GDIST(J)/1000.0)
10510 IF(GDIST(J).LT.100000.0)GOTO 908
10520 CALL RANDOM(D)
10530 IF(D.GT.0.0005)GSPD=0.0 
10540 908 IF(LASS4.EQ.0)GOTO 999
10550 IF(IDUM(J).EQ.0)GOTO 955
10560 IDUM(J)=MAX0(IDUM(J)-LASS4,0) 
10570 IF(IDUM(J).GT.0)GOTO 890
10580 GDIST(J)=100000.0 $ IGKILL(J)=0 
10590 RGSH(J)=100.0 $ GSPD=0.0 $ IDUM(J)=0
10600 955 XN=GDIST(J) 
10610 GDIST(J)=GDIST(J)-GSPD*LASS4
10620 IF((XN.GT.70000).AND.(GDIST(J).LE.70000))GOTO 988 
10630 GOTO 987
10640 1009 FORMAT("GORN BASE",I2," JUST ENTERED THE COMBAT ZONE.")
10650 988 DO 1010 I=1,MTAB(4) 
10660 IF(SPORT(I).LT.0)GOTO 1010
10670 PRINT 1009,J
10680 1010 CONTINUE 
10690 CALL RPORT
10700 987 XP(J)=CN*GDIST(J) 
10710 YP(J)=SN*GDIST(J) 
10720 RGSH(J)=AMIN1((RGSH(J)+LASS4/6.0),100.0)
10730 IGW(J)=MAX0(IGW(J)-LASS4,0) 
10740 999 XN=XP(J)-X(K) $ YN=YP(J)-Y(K) 
10750 IF(XN.EQ.0.) XN=0.000001
10760 TD=ATAN2(YN,XN) 
10770 AZ(J+15)=PICUT(TD-HEAD(K))
10780 TD=TD-PI
10790 XV(J+15)=-GSPD*CN-0.0009*GDIST(J)*SN
10800 YV(J+15)=0.0009*GDIST(J)*CN-GSPD*SN 
10810 IF(XV(J).EQ.0)XV(J)=0.000001
10820 SPEED(J+15)=SQRT(XV(J+15)*XV(J+15)+YV(J+15)*YV(J+15)) 
10830 COURSE(J+15)=PICUT(TD-ATAN2(YV(J+15),XV(J+15))) 
10840 IR(J+15)=IFIX(SQRT(XN*XN+YN*YN))
10850 IF(IR(J+15).LT.30000)IOK=.F.
10860 IXXX=(LASS4-IGW(J))/(ITHTM(J))
10870 IXXX=IXXX+1 
10880 I=0 
10890 GRNG=GNEAR=1.0E10 
10900 DO 972 II=1,15
10910 IF(IDMG(II).GE.100)GOTO 972 
10920 IF(ITN(II).LE.0)GOTO 972
10930 XN=XP(J)-X(II)
10940 YN=YP(J)-Y(II)
10950 III=(XN*XN+YN*YN) 
10960 IF(III.LE.6.25E8)GOTO 971 
10970 IF((GRNG.NE.1.0E10).OR.(III.GT.GNEAR))GOTO 973
10980 I=II $ GNEAR=III
10990 973 IF(RCENT(II).LT.70000)GOTO 972
11000 971 IF(III.GE.GRNG)GOTO 972 
11010 GRNG=III
11020 I=II
11030 972 CONTINUE
11040 XN=XP(J)-X(I) 
11050 IF(XN.EQ.0)XN=0.000001
11060 YN=YP(J)-Y(I) 
11070 RHEAD(J+15)=PICUT(TD-ATAN2(-YN,-XN))
11080 IF(IGW(J).GT.0)GOTO 975 
11090 IF(GRNG.GE.1.0E10)GOTO 975
11100 ITHTM(J)=45 
11110 IGW(J)=ITHTM(J) 
11120 D=PICUT(ATAN2(YN,XN)-HEAD(I)) 
11130 JK=1
11140 IF(ABS(D).GT.0.523598776)JK=2 
11150 1977 IXXX=IXXX-1
11160 IF(IXXX.LT.0)GOTO 975 
11170 ITREP(I)=MAX0(ITREP(I),40)
11180 IHITD=10+45000*(30-IPWRS(JK,I))/(SQRT(GRNG)+1)
11190 IHIT=IHITD/2
11200 IF(JK.EQ.1)IHITD=IHIT 
11210 IHITD=MIN0(100-ISHDMG(JK,I),IHITD)
11220 ISHDMG(JK,I)=ISHDMG(JK,I)+IHITD 
11230 IPWRS(JK,I)=MIN0((100-ISHDMG(JK,I))/4,IPWRS(JK,I))
11240 IHIT=MIN0(IHIT,100-IDMG(I)) 
11250 IDMG(I)=IDMG(I)+IHIT
11260 INXP(I)=MOD(INXP(I),40)+1 
11270 INX(INXP(I),I)=IHIT.OR.SHIFT(IHITD,12).OR.SHIFT(J+15,24)
11280+ .OR.SHIFT(JK,36).OR.SHIFT(I,48)
11290 IF(IDMG(I).LT.100)GOTO 1977 
11300 IGKILL(J)=IGKILL(J)+1 
11310 CALL NEWMESS(6,J+15,I)
11320 IF(IXXX.EQ.0)GOTO 975 
11330 975 IF(IDMG(K).GE.100)GOTO 890
11340* DETERMINE HITS MADE ON GORNS 
11350 IF(IDUM(J).GT.0)GOTO 890
11360 DO 970 I=1,3
11370 IF(IFLAG(I).EQ.0)GOTO 970 
11380 IF(IFLAG(I).EQ.1)GOTO 976 
11390 IF(MIS(K).EQ.0)GOTO 970 
11400 IF(IFLAG(I).NE.J+21)GOTO 970
11410 IF(LMTIM(1,K).GT.0)GOTO 330 
11420 LMTIM(1,K)=60 
11430 GOTO 331
11440 330 IF(LMTIM(2,K).GT.0) GOTO 970
11450 LMTIM(2,K)=60 
11460 331 MIS(K)=MIS(K)-1 
11470 IF(IR(J+15).GE.20000)GOTO 970 
11480 IF(ABS(AZ(J+15)).GT.0.087266463)GOTO 970
11490 IHITD=(112-RGSH(J))/3 
11500 GOTO 332
11510 976 IF(ABS(AZ(J+15)).GT.0.018325783)GOTO 970
11520 IHITD=IBEAM*3*(125-RGSH(J))/(IR(J+15)+1)
11530 332 IF(IHITD.EQ.0)GOTO 970
11540 IHITD=MIN0(IFIX(RGSH(J)),IHITD) 
11550 RGSH(J)=RGSH(J)-IHITD 
11560 INXP(K)=MOD(INXP(K),40)+1 
11570 MOAN=1
11580 IF(IFLAG(I).EQ.1)MOAN=3 
11590 INX(INXP(K),K)=IHITD.OR.SHIFT(J+15,12).OR.SHIFT(K,24).OR. 
11600+ SHIFT(MOAN,36).OR.SHIFT(J+15,48) 
11610 IF(RGSH(J).GE.1.0)GOTO 970
11620 IDUM(J)=1200
11630 KILLS(K)=KILLS(K)+1 
11640 IDMG(K)=ISHDMG(1,K)=ISHDMG(2,K)=0 
11650 IPWRS(1,K)=MIN0(ISPCH(1),(100-ISHDMG(1,K))/4) 
11660 IPWRS(2,K)=MIN0(ISPCH(2),(100-ISHDMG(2,K))/4) 
11670 IF(MOD(KILLS(K),5).EQ.0) MIS(K)=25
11680 IPOW(K)=IPOW(K)+IGKILL(J)*10000+30000 
11690 CALL NEWMESS(6,K,J+15)
11700 GOTO 890
11710 970 CONTINUE
11720 890 CONTINUE
11730 RETURN
11740 END 
